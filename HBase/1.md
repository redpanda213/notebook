# NoSQL综述

## NoSQL是什么

`not only SQL`,非关系型数据库

- 指不遵循传统RDBMS模型的数据库
- 数据是非关系的，且不使用SQL作为主要查询语言
- 解决数据库的可伸缩性和可用性问题、
- 不针对原子性或一致性问题（比如银行实时同步存取钱）

## 为什么用NoSQL

传统关系型数据库存在瓶颈

## NoSQL和关系型数据库对比

| 对比       | NoSQL                 | 关系型数据库             |
| ---------- | --------------------- | ------------------------ |
| 常用数据库 | HBase、MongoDB、Redis | Oracle、DB2、MySQL       |
| 存储格式   | 文档、键值对、图结构  | 表结构、行和列           |
| 存储规范   | 鼓励冗余              | 规范性、避免重复         |
| 存储扩展   | 横向扩展、分布式      | 纵向扩展（横向扩展有限） |
| 查询方式   | 结构化查询语言SQL     | 非结构化查询             |
| 事务       | 不支持事务一致性      | 支持事务                 |
| 性能       | 读写性能高            | 续写性能差               |
| 成本       | 开源、成本低          | 高                       |

## NoSQL特点

- 最终一致性（比如微博博文不一定要发一条微博此时就让别人看到，但最终一定会让别人看到）
- 冗余数据存储

> **CAP定理 (CAP theorem)**
>
> 布鲁尔定理： 
>
> 对于一个分布式计算机系统来说，不能同时满足以下三点：
>
> - 一致性consistency： (所有节点在同一时间具有相同的数据)
> - 可用性availability：(保证每个请求不管成功或者失败都有响应)
> - 分隔容忍partition tolerance：(系统中任意信息的丢失或失败不会影响系统的继续运作)
>
> 最多同时可以满足两个
>
> CP-单点集群，可扩展性不强
>
> CA-性能不强
>
> AP-对一致性要求低

> **BASE**·
>
> Basically Availble：基本可用，保证核心可用
>
> Soft-state：状态可以有一段时间不同步
>
> Eventual Consistency：系统经过一定时间后，数据最终能够达到一致的状态
>
> **最终一致性**

## 索引和查询

### indexing索引

大多数NoSQL按key进行索引

部分NoSQL允许二级索引

HBase使用HDFS,append-only：批处理写入logged，重新创建并排序文件

### Query查询

MapReduce、SQL部分支持

## NoSQL分类

| 分类           | 举例                         | 典型应用场景             |
| -------------- | ---------------------------- | ------------------------ |
| 键值存储数据库 | Redis、MemcacheDB、Voldemort | 内容缓存等               |
| 列存储数据库   | Cassandra，HBase             | 应对分布式存储的海量数据 |
| 文档型数据库   | CouchDB,MongoDB              | Web应用                  |
| 图数据库       | Neo4J、InfoGrid、Graph       | 社交网络、推荐系统，     |

## NoSQL和BI、大数据的关系

- BI（Business Intelligence）：商务智能
  它是一套完整的解决方案
  BI应用涉及模型，模型依赖于模式
  BI主要支持标准SQL，对NoSQL支持弱于关系型数据库

- NoSQL和大数据相关性较高
  通常大数据场景采用列存储数据库
  如：HBase和Hadoop